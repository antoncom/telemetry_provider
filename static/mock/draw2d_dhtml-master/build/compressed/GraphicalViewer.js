/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.GraphicalViewer=function(id){try{draw2d.Workflow.call(this,id);this.factory=null;this.model=null;this.initDone=false;}catch(e){pushErrorStack(e,"draw2d.GraphicalViewer=function(/*:String*/ id)");}};draw2d.GraphicalViewer.prototype=new draw2d.Workflow();draw2d.GraphicalViewer.prototype.type="draw2d.GraphicalViewer";draw2d.GraphicalViewer.prototype.setEditPartFactory=function(_933){this.factory=_933;this.checkInit();};draw2d.GraphicalViewer.prototype.setModel=function(_934){try{if(_934 instanceof draw2d.AbstractObjectModel){this.model=_934;this.checkInit();this.model.addPropertyChangeListener(this);}else{alert("Invalid model class type:"+_934.type);}}catch(e){pushErrorStack(e,"draw2d.GraphicalViewer.prototype.setModel=function(/*:draw2d.AbstractObjectModel*/ model )");}};draw2d.GraphicalViewer.prototype.propertyChange=function(_935){switch(_935.property){case draw2d.AbstractObjectModel.EVENT_ELEMENT_REMOVED:var _936=this.getFigure(_935.oldValue.getId());this.removeFigure(_936);break;case draw2d.AbstractObjectModel.EVENT_ELEMENT_ADDED:var _936=this.factory.createEditPart(_935.newValue);_936.setId(_935.newValue.getId());this.addFigure(_936);this.setCurrentSelection(_936);break;}};draw2d.GraphicalViewer.prototype.checkInit=function(){if(this.factory!==null&&this.model!==null&&this.initDone==false){try{var _937=this.model.getModelChildren();var _938=_937.getSize();for(var i=0;i<_938;i++){var _93a=_937.get(i);var _93b=this.factory.createEditPart(_93a);_93b.setId(_93a.getId());this.addFigure(_93b);}}catch(e){pushErrorStack(e,"draw2d.GraphicalViewer.prototype.checkInit=function()[addFigures]");}try{var _93c=this.getDocument().getFigures();var _938=_93c.getSize();for(var i=0;i<_938;i++){var _93b=_93c.get(i);if(_93b instanceof draw2d.Node){this.refreshConnections(_93b);}}}catch(e){pushErrorStack(e,"draw2d.GraphicalViewer.prototype.checkInit=function()[refreshConnections]");}}};draw2d.GraphicalViewer.prototype.refreshConnections=function(node){try{var _93e=new draw2d.ArrayList();var _93f=node.getModelSourceConnections();var _940=_93f.getSize();for(var i=0;i<_940;i++){var _942=_93f.get(i);_93e.add(_942.getId());var _943=this.getLine(_942.getId());if(_943===null){_943=this.factory.createEditPart(_942);var _944=_942.getSourceModel();var _945=_942.getTargetModel();var _946=this.getFigure(_944.getId());var _947=this.getFigure(_945.getId());var _948=_946.getOutputPort(_942.getSourcePortName());var _949=_947.getInputPort(_942.getTargetPortName());_943.setTarget(_949);_943.setSource(_948);_943.setId(_942.getId());this.addFigure(_943);this.setCurrentSelection(_943);}}var _94a=node.getOutputPorts();_940=_94a.getSize();for(var i=0;i<_940;i++){var _94b=_94a.get(i).getConnections();var _94c=_94b.getSize();for(var ii=0;ii<_94c;ii++){var _94e=_94b.get(ii);if(!_93e.contains(_94e.getId())){this.removeFigure(_94e);_93e.add(_94e.getId());}}}}catch(e){pushErrorStack(e,"draw2d.GraphicalViewer.prototype.refreshConnections=function(/*:draw2d.Node*/ node )");}};